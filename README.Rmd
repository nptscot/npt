---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  collapse = TRUE,
  comment = "#>"
)
```

# Network Planning Tool for Scotland

<!-- badges: start -->
<!-- badges: end -->

The aim of this project is to generate evidence to support strategic cycle network planning in Scotland.

# Reproducibility: basic

To reproduce the basic results in this repository, hosted on GitHub at nptscot/npt, first download and unzip or clone it and then open the 'npt' folder in your favourite integrated development environment (IDE) for R, such as RStudio.

- You can download the repository as a zip file from the GitHub website by clicking on the green 'Code' button and selecting 'Download ZIP', hosted at this URL: https://www.github.com/nptscot/npt/archive/refs/heads/main.zip
- You can clone the repo with Git as follows:
  
  ```bash
  git clone https://www.github.com/nptscot/npt.git
  ```
- Or (recommended for future-proof workflows) you can install the GitHub CLI tool and clone the repo as follows:
  
  ```bash
  gh repo clone nptscot/npt
  ```

Install the GitHub CLI tools by following instructions here: https://cli.github.com/manual/installation

Note: you can check to see if you have the GitHub CLI tools installed by running the following command from the R console:

```{r}
gh_version = try({
  system("gh --version", intern = TRUE)
})
gh_version
if(is(gh_version, "try-error")) {
  message("You don't have the GitHub CLI tools installed. Please install them by following instructions here: https://cli.github.com/manual/installation")
}
```

## Set-up

We will use the following packages:

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(tmap)
library(sf)
```
## Reading in input datasets

Read-in the input datasets as follows:

```{r}
list.files("data-raw")
od_data = read_csv("data-raw/od_subset.csv")

```

# Reproducibility: advanced

Note: to reproduce the full build process currently depends on data sources and dependencies that are not publicly available. This is a work in progress.

Then run the following command (requires dependencies and data to be present):

```{r, eval=FALSE, echo=FALSE}
targets::tar_make()
```

Note: you need to have a CYCLESTREETS API key for this, see here for details: https://rpackage.cyclestreets.net/reference/journey.html#details-1

This project uses `targets` for data processing pipeline management, with outputs like this:

![](https://user-images.githubusercontent.com/1825120/205490893-b1627e3a-5102-4dbe-bc70-97e358e75506.png)

Visualise the project as follows:

```{r visnet}
# targets::tar_visnetwork(targets_only = TRUE)
```

The zones in the case study region are as follows:

```{r zones, echo=FALSE}
# targets::tar_load(zones)
# knitr::include_graphics("figures/test-plot.png")
tmap_mode("plot")
tm_shape(zones) +
  tm_polygons(col = "TotPop2011", palette = "viridis")
```

Baseline cycling levels are shown below:

```{r overline}
tm_shape(rnet) +
  tm_lines(lwd = "bicycle", scale = 9)
```

